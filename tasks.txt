=================================================================================================================
=== Автоматическое списание неизрасходованных резервов на [УказаннуюДату]
=================================================================================================================

(Наверное правильно для начала выбрать остатки по регистру на текущую дату, если там 0 то и смысла дальше что-то делать нет)


1. Выбираем из регистра РезервТоваров записи с видом движения [Приход] (т.е. постановка в резерв) и у которых дата окончания
резервирования меньше указанной даты, т.е. резерв истёк. Сохр. результат во временной таблице.

ВЫБРАТЬ
	РезервТоваров.Период КАК Период,
	РезервТоваров.Регистратор.Ссылка КАК РегистраторСсылка,
	РезервТоваров.ВидДвижения КАК ВидДвижения,
	РезервТоваров.Номенклатура КАК Номенклатура,
	РезервТоваров.Склад КАК Склад,
	РезервТоваров.Контрагент КАК Контрагент,
	РезервТоваров.Количество КАК Количество,
	РезервТоваров.ОкончаниеРезерва КАК ОкончаниеРезерва
ПОМЕСТИТЬ втРезервирующиеДокументы
ИЗ
	РегистрНакопления.РезервТоваров КАК РезервТоваров
ГДЕ
	РезервТоваров.ОкончаниеРезерва < &ТекущаяДата
	И РезервТоваров.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	
	

2. Выбираем из регистра РезервТоваров записи у которых РезервирущимДокументом явл. регистраторы (документы) из предыдущего
запроса. Так мы узнаем проходили ли какие-нибудь движения по резервам сформированным документами из предыдущего запроса.

ВЫБРАТЬ
	РезервТоваров.Период КАК Период,
	РезервТоваров.Регистратор.Ссылка КАК РегистраторСсылка,
	РезервТоваров.ВидДвижения КАК ВидДвижения,
	РезервТоваров.Номенклатура КАК Номенклатура,
	РезервТоваров.Склад КАК Склад,
	РезервТоваров.Контрагент КАК Контрагент,
	РезервТоваров.Количество КАК Количество,
	РезервТоваров.РезервирующийДокумент.Ссылка КАК РезервирующийДокументСсылка
ИЗ
	РегистрНакопления.РезервТоваров КАК РезервТоваров
ГДЕ
	РезервТоваров.РезервирующийДокумент.Ссылка В
			(ВЫБРАТЬ
				втРезервирующиеДокументы.РегистраторСсылка
			ИЗ
				втРезервирующиеДокументы)
				
Как работает Списание Резервов при проведении документа РасходнаяНакладная:

При проведении РасходнойНакладной не спишется с резервов большее количество номенклатуры чем указано в Счёте.


=================================================================================================================